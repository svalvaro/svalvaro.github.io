{
  "hash": "080f5062ac11362a7ab3f9be6793936a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"A comprehensive analysis of market sales\"\ndescription: \"TBD\"\nauthor:\n  - name: Álvaro Sánchez\n    url: https://svalvaro.github.io/\ndate: 11-19-2024\ncategories: [R, time series]\nimage: tbd\ndraft: false \nfreeze: true\ncode-fold: true\n---\n\n\n\n# Time Series Analysis\nWe'll be using a sales dataset from a supermakert chain [source](https://www.kaggle.com/datasets/aungpyaeap/supermarket-sales?resource=download).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndataset <- readr::read_csv(\"data.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(dataset) |> \n  kableExtra::kable(\"html\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Invoice ID </th>\n   <th style=\"text-align:left;\"> Branch </th>\n   <th style=\"text-align:left;\"> City </th>\n   <th style=\"text-align:left;\"> Customer type </th>\n   <th style=\"text-align:left;\"> Gender </th>\n   <th style=\"text-align:left;\"> Product line </th>\n   <th style=\"text-align:right;\"> Unit price </th>\n   <th style=\"text-align:right;\"> Quantity </th>\n   <th style=\"text-align:right;\"> Tax 5% </th>\n   <th style=\"text-align:right;\"> Total </th>\n   <th style=\"text-align:left;\"> Date </th>\n   <th style=\"text-align:left;\"> Time </th>\n   <th style=\"text-align:left;\"> Payment </th>\n   <th style=\"text-align:right;\"> cogs </th>\n   <th style=\"text-align:right;\"> gross margin percentage </th>\n   <th style=\"text-align:right;\"> gross income </th>\n   <th style=\"text-align:right;\"> Rating </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 750-67-8428 </td>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> Yangon </td>\n   <td style=\"text-align:left;\"> Member </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Health and beauty </td>\n   <td style=\"text-align:right;\"> 74.69 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 26.1415 </td>\n   <td style=\"text-align:right;\"> 548.9715 </td>\n   <td style=\"text-align:left;\"> 1/5/2019 </td>\n   <td style=\"text-align:left;\"> 13:08:00 </td>\n   <td style=\"text-align:left;\"> Ewallet </td>\n   <td style=\"text-align:right;\"> 522.83 </td>\n   <td style=\"text-align:right;\"> 4.761905 </td>\n   <td style=\"text-align:right;\"> 26.1415 </td>\n   <td style=\"text-align:right;\"> 9.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 226-31-3081 </td>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:left;\"> Naypyitaw </td>\n   <td style=\"text-align:left;\"> Normal </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Electronic accessories </td>\n   <td style=\"text-align:right;\"> 15.28 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 3.8200 </td>\n   <td style=\"text-align:right;\"> 80.2200 </td>\n   <td style=\"text-align:left;\"> 3/8/2019 </td>\n   <td style=\"text-align:left;\"> 10:29:00 </td>\n   <td style=\"text-align:left;\"> Cash </td>\n   <td style=\"text-align:right;\"> 76.40 </td>\n   <td style=\"text-align:right;\"> 4.761905 </td>\n   <td style=\"text-align:right;\"> 3.8200 </td>\n   <td style=\"text-align:right;\"> 9.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 631-41-3108 </td>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> Yangon </td>\n   <td style=\"text-align:left;\"> Normal </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Home and lifestyle </td>\n   <td style=\"text-align:right;\"> 46.33 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 16.2155 </td>\n   <td style=\"text-align:right;\"> 340.5255 </td>\n   <td style=\"text-align:left;\"> 3/3/2019 </td>\n   <td style=\"text-align:left;\"> 13:23:00 </td>\n   <td style=\"text-align:left;\"> Credit card </td>\n   <td style=\"text-align:right;\"> 324.31 </td>\n   <td style=\"text-align:right;\"> 4.761905 </td>\n   <td style=\"text-align:right;\"> 16.2155 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 123-19-1176 </td>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> Yangon </td>\n   <td style=\"text-align:left;\"> Member </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Health and beauty </td>\n   <td style=\"text-align:right;\"> 58.22 </td>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 23.2880 </td>\n   <td style=\"text-align:right;\"> 489.0480 </td>\n   <td style=\"text-align:left;\"> 1/27/2019 </td>\n   <td style=\"text-align:left;\"> 20:33:00 </td>\n   <td style=\"text-align:left;\"> Ewallet </td>\n   <td style=\"text-align:right;\"> 465.76 </td>\n   <td style=\"text-align:right;\"> 4.761905 </td>\n   <td style=\"text-align:right;\"> 23.2880 </td>\n   <td style=\"text-align:right;\"> 8.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 373-73-7910 </td>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> Yangon </td>\n   <td style=\"text-align:left;\"> Normal </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Sports and travel </td>\n   <td style=\"text-align:right;\"> 86.31 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 30.2085 </td>\n   <td style=\"text-align:right;\"> 634.3785 </td>\n   <td style=\"text-align:left;\"> 2/8/2019 </td>\n   <td style=\"text-align:left;\"> 10:37:00 </td>\n   <td style=\"text-align:left;\"> Ewallet </td>\n   <td style=\"text-align:right;\"> 604.17 </td>\n   <td style=\"text-align:right;\"> 4.761905 </td>\n   <td style=\"text-align:right;\"> 30.2085 </td>\n   <td style=\"text-align:right;\"> 5.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 699-14-3026 </td>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:left;\"> Naypyitaw </td>\n   <td style=\"text-align:left;\"> Normal </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Electronic accessories </td>\n   <td style=\"text-align:right;\"> 85.39 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 29.8865 </td>\n   <td style=\"text-align:right;\"> 627.6165 </td>\n   <td style=\"text-align:left;\"> 3/25/2019 </td>\n   <td style=\"text-align:left;\"> 18:30:00 </td>\n   <td style=\"text-align:left;\"> Ewallet </td>\n   <td style=\"text-align:right;\"> 597.73 </td>\n   <td style=\"text-align:right;\"> 4.761905 </td>\n   <td style=\"text-align:right;\"> 29.8865 </td>\n   <td style=\"text-align:right;\"> 4.1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\nLet's have a look at what the data looks like\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndplyr::glimpse(dataset)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,000\nColumns: 17\n$ `Invoice ID`              <chr> \"750-67-8428\", \"226-31-3081\", \"631-41-3108\",…\n$ Branch                    <chr> \"A\", \"C\", \"A\", \"A\", \"A\", \"C\", \"A\", \"C\", \"A\",…\n$ City                      <chr> \"Yangon\", \"Naypyitaw\", \"Yangon\", \"Yangon\", \"…\n$ `Customer type`           <chr> \"Member\", \"Normal\", \"Normal\", \"Member\", \"Nor…\n$ Gender                    <chr> \"Female\", \"Female\", \"Male\", \"Male\", \"Male\", …\n$ `Product line`            <chr> \"Health and beauty\", \"Electronic accessories…\n$ `Unit price`              <dbl> 74.69, 15.28, 46.33, 58.22, 86.31, 85.39, 68…\n$ Quantity                  <dbl> 7, 5, 7, 8, 7, 7, 6, 10, 2, 3, 4, 4, 5, 10, …\n$ `Tax 5%`                  <dbl> 26.1415, 3.8200, 16.2155, 23.2880, 30.2085, …\n$ Total                     <dbl> 548.9715, 80.2200, 340.5255, 489.0480, 634.3…\n$ Date                      <chr> \"1/5/2019\", \"3/8/2019\", \"3/3/2019\", \"1/27/20…\n$ Time                      <time> 13:08:00, 10:29:00, 13:23:00, 20:33:00, 10:…\n$ Payment                   <chr> \"Ewallet\", \"Cash\", \"Credit card\", \"Ewallet\",…\n$ cogs                      <dbl> 522.83, 76.40, 324.31, 465.76, 604.17, 597.7…\n$ `gross margin percentage` <dbl> 4.761905, 4.761905, 4.761905, 4.761905, 4.76…\n$ `gross income`            <dbl> 26.1415, 3.8200, 16.2155, 23.2880, 30.2085, …\n$ Rating                    <dbl> 9.1, 9.6, 7.4, 8.4, 5.3, 4.1, 5.8, 8.0, 7.2,…\n```\n\n\n:::\n:::\n\n\n\n# What are these folks buying?\nLet's check what are people buying...\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(ggstream)\nlibrary(cowplot)\nlibrary(dplyr)\n\n# Let's aggregate the data\ndata_product <- dataset |> \n  mutate(\n    formatted_date = lubridate::mdy(Date)\n  ) |> \n  group_by(Branch, formatted_date, `Product line`) |>\n  summarise(\n    n_products_sold = sum(Quantity),\n    .groups = \"drop\"\n  )\n\n# A function that we can use to plot the sales for the products at any branch\nstream_plot <- function(data, branch) {\n  data |> \n  filter(Branch == branch) |> \n    ggplot(aes(x = formatted_date, y = n_products_sold, fill = `Product line`)) +\n      geom_stream(type=\"mirror\") +\n       scale_fill_manual(values= c(\"#6d2f20\", \"#df7e66\", \"#e09351\", \"#edc775\", \"#94b594\", \"#224b5e\")) +\n      theme_void() \n}\n\nplot_a <- stream_plot(data_product, \"A\") + \n      theme(legend.position = \"none\")\nplot_b <- stream_plot(data_product, \"B\")+ \n      theme(legend.position = \"none\")\nplot_c <- stream_plot(data_product, \"C\") +\n    theme(\n      legend.position = c(0.52, -0.05),\n      legend.direction = \"horizontal\",\n      legend.text = element_blank(),\n      legend.title = element_blank(),\n      legend.key.height = unit(0.75, \"cm\"),\n      legend.key.width = unit(3.1, \"cm\")\n      ) +\n  guides(fill = guide_legend(nrow = 1))\n\n# Let's put everything together\nsource(\"helper_functions.R\")\nggdraw(plot_grid(plot_a, plot_b, plot_c, ncol=1)) +\n  theme(plot.background = element_rect(fill=\"#fbf7f0\", color=\"#fbf7f0\"),\n        plot.margin = margin(50, 30, 20)) +\n  draw_text(text = \"Daily Product Sales\", x=0.5, y=1.06, fontface=\"bold\", size= 30, family=font1, color=\"#224b5e\") +\n  draw_text(text=\"Jan\", x=0.07, y=1.015, size=15, family=font2, color=\"#224b5e\") +\n  draw_text(text=\"Feb\", x=0.35, y=1.015, size=15, family=font2, color=\"#224b5e\") +\n  draw_text(text=\"Mar\", x=0.65, y=1.015, size=15, family=font2, color=\"#224b5e\") +\n  draw_text(text=\"Apr\", x=0.95, y=1.015, size=15, family=font2, color=\"#224b5e\") +\n  draw_text(text=\"Electronics\", x=0.088, y=-0.016, size=12, family=font2, fontface=\"bold\", color=\"#fbf7f0\") +\n  draw_text(text=\"Fashion\", x=0.26, y=-0.016, size=12, family=font2, fontface=\"bold\", color=\"#fbf7f0\") +\n  draw_text(text=\"Food\", x=0.435, y=-0.016, size=12, family=font2, fontface=\"bold\", color=\"#fbf7f0\") +\n  draw_text(text=\"Health\", x=0.6, y=-0.016, size=12, family=font2, fontface=\"bold\", color=\"#fbf7f0\") +\n  draw_text(text=\"Home\", x=0.775, y=-0.016, size=12, family=font2, fontface=\"bold\", color=\"#fbf7f0\") +\n  draw_text(text=\"Sports\", x=0.95, y=-0.016, size=12, family=font2, fontface=\"bold\", color=\"#fbf7f0\") +\n  draw_text(text=\"Branch A\", x=0.97, y=0.83, size=20, family=font1, hjust=0, color=\"#224b5e\") +\n  draw_text(text=\"Branch B\", x=0.97, y=0.5, size=20, family=font1, hjust=0, color=\"#224b5e\") +\n  draw_text(text=\"Branch C\", x=0.97, y=0.17, size=20, family=font1, hjust=0, color=\"#224b5e\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n\n# Daily sales\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(lubridate)\n\nsummary <- dataset |> \n  mutate(\n    formatted_date = lubridate::mdy(Date)\n  ) |> \n  group_by(Branch, formatted_date) |>\n  summarise(\n    sum_sales = sum(Total),\n    .groups = \"drop\"\n  )\n\nsummary |> \n  head() |> \n  kableExtra::kable(\"html\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Branch </th>\n   <th style=\"text-align:left;\"> formatted_date </th>\n   <th style=\"text-align:right;\"> sum_sales </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> 2019-01-01 </td>\n   <td style=\"text-align:right;\"> 2371.3200 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> 2019-01-02 </td>\n   <td style=\"text-align:right;\"> 307.0515 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> 2019-01-03 </td>\n   <td style=\"text-align:right;\"> 937.4085 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> 2019-01-04 </td>\n   <td style=\"text-align:right;\"> 483.2625 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> 2019-01-05 </td>\n   <td style=\"text-align:right;\"> 2024.5050 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:left;\"> 2019-01-06 </td>\n   <td style=\"text-align:right;\"> 1309.9695 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\nWe can use ggplot2 for visualising the data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(viridis)\n\n# I'll load a custom theme\n\nsource(\"helper_functions.R\")\n\ntemp_summary <- summary |> \n  mutate(name_branch = Branch)\n\ntemp_summary |> \n  ggplot(aes(x = formatted_date, y = sum_sales)) +\n    geom_line( data=temp_summary %>% dplyr::select(-Branch), aes(group=name_branch), color=\"grey\", size=0.5, alpha=0.5) +\n    geom_line( aes(color = Branch), color=\"#69b3a2\", size=1.2 )+\n    scale_color_viridis(discrete = TRUE) +\n    custom_theme() +\n    theme(\n      legend.position=\"none\",\n      plot.title = element_text(size=14),\n      axis.title.y = element_blank(),\n      axis.title.x = element_blank()\n    ) +\n    labs(\n      title = \"Daily Sales ($)\",\n      subtitle = \"Daily sales in the first quarter of 2019 in three different branches\",\n      caption = \"https://svalvaro.github.io/\"\n      \n    ) + \n    facet_wrap(~Branch, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n\nLet's add some interactivity and use the plotly library ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}